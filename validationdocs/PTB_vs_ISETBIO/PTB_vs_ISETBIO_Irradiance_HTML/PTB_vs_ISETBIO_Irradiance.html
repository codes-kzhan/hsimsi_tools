
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>PTB_vs_ISETBIO_Irradiance</title><meta name="generator" content="MATLAB 8.4"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2014-10-09"><meta name="DC.source" content="PTB_vs_ISETBIO_Irradiance.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h2>Contents</h2><div><ul><li><a href="#2">Validation script for PTB_vs_ISETBIO_Irradiance test</a></li><li><a href="#4">Initialize return params</a></li><li><a href="#5">Initialize ISETBIO</a></li><li><a href="#6">Set computation params</a></li><li><a href="#7">Create a radiance image in ISETBIO</a></li><li><a href="#8">Compute the irradiance in ISETBIO</a></li><li><a href="#9">Get wavelength and spectral radiance spd data (averaged within the scene ROI)</a></li><li><a href="#10">Get wavelength and spectral irradiance spd data (averaged within the scene ROI)</a></li><li><a href="#11">Get the underlying parameters that are needed from the ISETBIO structures.</a></li><li><a href="#12">Compute the irradiance in PTB</a></li><li><a href="#13">Numerical check to decide whether we passed.</a></li><li><a href="#14">Set validationReport, validationFailedFlag and validationData</a></li><li><a href="#15">Generate plots, if so specified</a></li></ul></div><pre class="codeinput"><span class="keyword">function</span> PTB_vs_ISETBIO_Irradiance(runParams)
<span class="comment">%</span>
<span class="comment">%   Validate ISETBIO-based irradiance computations by comparing to PTB-based irradiance computations.</span>
<span class="comment">%</span>

    <span class="comment">% Call the validation script</span>
    [validationReport, validationFailedFlag, validationDataToSave] = validationScript(runParams);

    <span class="comment">% Update the parent @UnitTest object</span>
    UnitTest.updateParentUnitTestObject(validationReport, validationFailedFlag, validationDataToSave, runParams);
<span class="keyword">end</span>
</pre><h2>Validation script for PTB_vs_ISETBIO_Irradiance test<a name="2"></a></h2><pre class="codeinput"><span class="keyword">function</span> [validationReport, validationFailedFlag, validationDataToSave] = validationScript(runParams)
</pre><h2>Initialize return params<a name="4"></a></h2><pre class="codeinput">    validationReport = <span class="string">'None'</span>;
    validationFailedFlag = true;
    validationDataToSave = struct();
</pre><h2>Initialize ISETBIO<a name="5"></a></h2><pre class="codeinput">    s_initISET;
</pre><h2>Set computation params<a name="6"></a></h2><pre class="codeinput">    fov     = 20;  <span class="comment">% need large field</span>
    roiSize = 5;
</pre><h2>Create a radiance image in ISETBIO<a name="7"></a></h2><pre class="codeinput">    scene = sceneCreate(<span class="string">'uniform ee'</span>);    <span class="comment">% Equal energy</span>
    scene = sceneSet(scene,<span class="string">'name'</span>,<span class="string">'Equal energy uniform field'</span>);
    scene = sceneSet(scene,<span class="string">'fov'</span>, fov);
</pre><h2>Compute the irradiance in ISETBIO<a name="8"></a></h2><p>To make comparison to PTB work, we turn off off axis correction as well as optical blurring in the optics.</p><pre class="codeinput">    oi     = oiCreate(<span class="string">'human'</span>);
    optics = oiGet(oi,<span class="string">'optics'</span>);
    optics = opticsSet(optics,<span class="string">'off axis method'</span>,<span class="string">'skip'</span>);
    optics = opticsSet(optics,<span class="string">'otf method'</span>,<span class="string">'skip otf'</span>);
    oi     = oiSet(oi,<span class="string">'optics'</span>,optics);
    oi     = oiCompute(oi,scene);

    <span class="comment">% Define a region of interest starting at the scene's center with size</span>
    <span class="comment">% roiSize x roiSize</span>
    sz = sceneGet(scene,<span class="string">'size'</span>);
    rect = [sz(2)/2,sz(1)/2,roiSize,roiSize];
    sceneRoiLocs = ieRoi2Locs(rect);
</pre><h2>Get wavelength and spectral radiance spd data (averaged within the scene ROI)<a name="9"></a></h2><pre class="codeinput">    wave  = sceneGet(scene,<span class="string">'wave'</span>);
    radiancePhotons = sceneGet(scene,<span class="string">'roi mean photons'</span>, sceneRoiLocs);
    radianceEnergy  = sceneGet(scene,<span class="string">'roi mean energy'</span>,  sceneRoiLocs);

    <span class="comment">% Need to recenter roi because the optical image is</span>
    <span class="comment">% padded to deal with optical blurring at its edge.</span>
    sz         = oiGet(oi,<span class="string">'size'</span>);
    rect       = [sz(2)/2,sz(1)/2,roiSize,roiSize];
    oiRoiLocs  = ieRoi2Locs(rect);
</pre><h2>Get wavelength and spectral irradiance spd data (averaged within the scene ROI)<a name="10"></a></h2><pre class="codeinput">    wave                    = oiGet(scene,<span class="string">'wave'</span>);
    isetbioIrradianceEnergy = oiGet(oi, <span class="string">'roi mean energy'</span>, oiRoiLocs);
</pre><h2>Get the underlying parameters that are needed from the ISETBIO structures.<a name="11"></a></h2><pre class="codeinput">    optics = oiGet(oi,<span class="string">'optics'</span>);
    pupilDiameterMm  = opticsGet(optics,<span class="string">'pupil diameter'</span>,<span class="string">'mm'</span>);
    focalLengthMm    = opticsGet(optics,<span class="string">'focal length'</span>,<span class="string">'mm'</span>);
</pre><h2>Compute the irradiance in PTB<a name="12"></a></h2><p>The PTB calculation is encapsulated in ptb.ConeIsomerizationsFromRadiance. This routine also returns cone isomerizations, which we are not validating here. The macular pigment and integration time parameters affect the isomerizations, but don't affect the irradiance returned by the PTB routine. The integration time doesn't affect the irradiance, but we need to pass it</p><pre class="codeinput">    macularPigmentOffset = 0;
    integrationTimeSec   = 0.05;
    [isoPerCone, ~, ptbPhotoreceptors, ptbIrradiance] = <span class="keyword">...</span>
        ptb.ConeIsomerizationsFromRadiance(radianceEnergy(:), wave(:),<span class="keyword">...</span>
        pupilDiameterMm, focalLengthMm, integrationTimeSec,macularPigmentOffset);

    <span class="comment">% Compare irradiances computed by ISETBIO vs. PTB</span>
    <span class="comment">% accounting for the magnification difference.</span>
    <span class="comment">% The magnification difference results from how Peter Catrysse implemented the radiance to irradiance</span>
    <span class="comment">% calculation in isetbio versus the simple trig formula used in PTB. Correcting for this reduces the difference</span>
    <span class="comment">% to about 1%.</span>
    m = opticsGet(optics,<span class="string">'magnification'</span>,sceneGet(scene,<span class="string">'distance'</span>));
    ptbMagCorrectIrradiance = ptbIrradiance(:)/(1+abs(m))^2;
</pre><h2>Numerical check to decide whether we passed.<a name="13"></a></h2><p>We are checking against a 1% error.</p><pre class="codeinput">    tolerance = 0.01;

    ptbMagCorrectIrradiance = ptbMagCorrectIrradiance(:);
    isetbioIrradianceEnergy = isetbioIrradianceEnergy(:);
    difference = ptbMagCorrectIrradiance-isetbioIrradianceEnergy;
</pre><h2>Set validationReport, validationFailedFlag and validationData<a name="14"></a></h2><pre class="codeinput">    <span class="keyword">if</span> (max(abs(difference./isetbioIrradianceEnergy)) &gt; tolerance)
        validationReport     = sprintf(<span class="string">'Validation FAILED. Difference between PTB and isetbio irradiance exceeds tolerance of %0.5f %% !!!'</span>, 100*tolerance);
        validationFailedFlag = true;
    <span class="keyword">else</span>
        validationReport     = sprintf(<span class="string">'Validation PASSED. PTB and isetbio agree about irradiance to %0.5f %%'</span>,100*tolerance);
        validationFailedFlag = false;
    <span class="keyword">end</span>

    validationDataToSave.fov        = fov;
    validationDataToSave.roiSize    = roiSize;
    validationDataToSave.tolerance  = tolerance;
    validationDataToSave.scene      = scene;
    validationDataToSave.oi         = oi;
    validationDataToSave.ptbMagCorrectIrradiance = ptbMagCorrectIrradiance;
    validationDataToSave.isetbioIrradianceEnergy = isetbioIrradianceEnergy;
</pre><h2>Generate plots, if so specified<a name="15"></a></h2><pre class="codeinput">    <span class="keyword">if</span> (nargin &gt;= 1) &amp;&amp; (isfield(runParams, <span class="string">'generatePlots'</span>)) &amp;&amp; (runParams.generatePlots == true)
        h = figure(500);
        clf;
        set(h, <span class="string">'Position'</span>, [100 100 800 600]);
        subplot(2,1,1);
        plot(wave, ptbIrradiance, <span class="string">'ro'</span>, <span class="string">'MarkerFaceColor'</span>, [1.0 0.8 0.8], <span class="string">'MarkerSize'</span>, 10);
        hold <span class="string">on</span>;
        plot(wave, isetbioIrradianceEnergy, <span class="string">'bo'</span>, <span class="string">'MarkerFaceColor'</span>, [0.8 0.8 1.0], <span class="string">'MarkerSize'</span>, 10);
        hold <span class="string">off</span>
        set(gca,<span class="string">'ylim'</span>,[0 1.2*max([max(ptbIrradiance(:)) max(isetbioIrradianceEnergy(:))])]);
        set(gca, <span class="string">'FontName'</span>, <span class="string">'Helvetica'</span>, <span class="string">'FontSize'</span>, 14,  <span class="string">'FontWeight'</span>, <span class="string">'bold'</span>);
        legend({<span class="string">'PTB'</span>,<span class="string">'ISETBIO'</span>}, <span class="string">'Location'</span>,<span class="string">'SouthEast'</span>,<span class="string">'FontSize'</span>,12);
        xlabel(<span class="string">'Wave (nm)'</span>, <span class="string">'FontName'</span>, <span class="string">'Helvetica'</span>, <span class="string">'FontSize'</span>, 16); ylabel(<span class="string">'Irradiance (q/s/nm/m^2)'</span>, <span class="string">'FontName'</span>, <span class="string">'Helvetica'</span>, <span class="string">'FontSize'</span>, 16)
        title(<span class="string">'Without magnification correction'</span>, <span class="string">'FontName'</span>, <span class="string">'Helvetica'</span>, <span class="string">'FontSize'</span>, 18, <span class="string">'FontWeight'</span>, <span class="string">'bold'</span>);

        subplot(2,1,2);
        plot(wave,ptbMagCorrectIrradiance,<span class="string">'ro'</span>, <span class="string">'MarkerFaceColor'</span>, [1.0 0.8 0.8], <span class="string">'MarkerSize'</span>, 10);
        hold <span class="string">on</span>;
        plot(wave,isetbioIrradianceEnergy,<span class="string">'bo'</span>, <span class="string">'MarkerFaceColor'</span>, [0.8 0.8 1.0], <span class="string">'MarkerSize'</span>, 10);
        hold <span class="string">off</span>
        set(gca,<span class="string">'ylim'</span>,[0 1.2*max([max(ptbIrradiance(:)) max(isetbioIrradianceEnergy(:))])]);
        set(gca, <span class="string">'FontName'</span>, <span class="string">'Helvetica'</span>, <span class="string">'FontSize'</span>, 14, <span class="string">'FontWeight'</span>, <span class="string">'bold'</span>);
        xlabel(<span class="string">'Wave (nm)'</span>, <span class="string">'FontName'</span>, <span class="string">'Helvetica'</span>, <span class="string">'FontSize'</span>, 14); ylabel(<span class="string">'Irradiance (q/s/nm/m^2)'</span>, <span class="string">'FontName'</span>, <span class="string">'Helvetica'</span>, <span class="string">'FontSize'</span>, 14)
        legend({<span class="string">'PTB'</span>,<span class="string">'ISETBIO'</span>}, <span class="string">'Location'</span>,<span class="string">'SouthEast'</span>,<span class="string">'FontSize'</span>,12)
        title(<span class="string">'Magnification-corrected comparison'</span>, <span class="string">'FontName'</span>, <span class="string">'Helvetica'</span>, <span class="string">'FontSize'</span>, 18, <span class="string">'FontWeight'</span>, <span class="string">'bold'</span>);
    <span class="keyword">end</span>
</pre><img vspace="5" hspace="5" src="PTB_vs_ISETBIO_Irradiance_01.png" alt=""> <pre class="codeinput"><span class="keyword">end</span>
</pre><pre class="codeoutput">
[ 1.] Results for 'PTB_vs_ISETBIO_Irradiance' probe:
	-----------------------------------------
	 validation status      : PASSED
	-----------------------------------------
	 validation report      : Validation PASSED. PTB and isetbio agree about irradiance to 1.00000 %
	-----------------------------------------------------------------------------------------------------------------------------
	 validation data saved  : 'fov', 'roiSize', 'tolerance', 'scene', 'oi', 'ptbMagCorrectIrradiance', 'isetbioIrradianceEnergy'
	-----------------------------------------------------------------------------------------------------------------------------
	 date last run          : 09-Oct-2014 17:05:46
	 matlabVersion          : 8.4.0.150421 (R2014b)
	 computer architecture  : MACI64
	 computer IP address    : manta.psych.upenn.edu
	 username               : nicolas
	 git branch...tracking  : dev...origin/dev of ISETBIO
	-----------------------------------------------------------------------------------------------------------------------------
</pre><p class="footer"><br><a href="http://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2014b</a><br></p></div><!--
##### SOURCE BEGIN #####
function PTB_vs_ISETBIO_Irradiance(runParams)
%
%   Validate ISETBIO-based irradiance computations by comparing to PTB-based irradiance computations.
% 

    % Call the validation script
    [validationReport, validationFailedFlag, validationDataToSave] = validationScript(runParams);
        
    % Update the parent @UnitTest object
    UnitTest.updateParentUnitTestObject(validationReport, validationFailedFlag, validationDataToSave, runParams);
end



%% Validation script for PTB_vs_ISETBIO_Irradiance test
function [validationReport, validationFailedFlag, validationDataToSave] = validationScript(runParams)

    %% Initialize return params
    validationReport = 'None'; 
    validationFailedFlag = true; 
    validationDataToSave = struct();
    
    
    %% Initialize ISETBIO
    s_initISET;
    
    
    %% Set computation params
    fov     = 20;  % need large field
    roiSize = 5;
    
    
    %% Create a radiance image in ISETBIO
    scene = sceneCreate('uniform ee');    % Equal energy
    scene = sceneSet(scene,'name','Equal energy uniform field');
    scene = sceneSet(scene,'fov', fov);

    
    %% Compute the irradiance in ISETBIO
    %
    % To make comparison to PTB work, we turn off
    % off axis correction as well as optical blurring
    % in the optics.
    oi     = oiCreate('human');
    optics = oiGet(oi,'optics');
    optics = opticsSet(optics,'off axis method','skip');
    optics = opticsSet(optics,'otf method','skip otf');
    oi     = oiSet(oi,'optics',optics);
    oi     = oiCompute(oi,scene);

    % Define a region of interest starting at the scene's center with size
    % roiSize x roiSize
    sz = sceneGet(scene,'size');
    rect = [sz(2)/2,sz(1)/2,roiSize,roiSize];
    sceneRoiLocs = ieRoi2Locs(rect);
    
    %% Get wavelength and spectral radiance spd data (averaged within the scene ROI) 
    wave  = sceneGet(scene,'wave');
    radiancePhotons = sceneGet(scene,'roi mean photons', sceneRoiLocs);
    radianceEnergy  = sceneGet(scene,'roi mean energy',  sceneRoiLocs); 
    
    % Need to recenter roi because the optical image is
    % padded to deal with optical blurring at its edge.
    sz         = oiGet(oi,'size');
    rect       = [sz(2)/2,sz(1)/2,roiSize,roiSize];
    oiRoiLocs  = ieRoi2Locs(rect);

    %% Get wavelength and spectral irradiance spd data (averaged within the scene ROI)
    wave                    = oiGet(scene,'wave');
    isetbioIrradianceEnergy = oiGet(oi, 'roi mean energy', oiRoiLocs);

    %% Get the underlying parameters that are needed from the ISETBIO structures.
    optics = oiGet(oi,'optics');
    pupilDiameterMm  = opticsGet(optics,'pupil diameter','mm');
    focalLengthMm    = opticsGet(optics,'focal length','mm');
    
    %% Compute the irradiance in PTB
    % The PTB calculation is encapsulated in ptb.ConeIsomerizationsFromRadiance.
    % This routine also returns cone isomerizations, which we are not validating here.
    % The macular pigment and integration time parameters affect the isomerizations,
    % but don't affect the irradiance returned by the PTB routine.
    % The integration time doesn't affect the irradiance, but we
    % need to pass it 
    macularPigmentOffset = 0;
    integrationTimeSec   = 0.05;
    [isoPerCone, ~, ptbPhotoreceptors, ptbIrradiance] = ...
        ptb.ConeIsomerizationsFromRadiance(radianceEnergy(:), wave(:),...
        pupilDiameterMm, focalLengthMm, integrationTimeSec,macularPigmentOffset);
    
    % Compare irradiances computed by ISETBIO vs. PTB
    % accounting for the magnification difference.
    % The magnification difference results from how Peter Catrysse implemented the radiance to irradiance
    % calculation in isetbio versus the simple trig formula used in PTB. Correcting for this reduces the difference
    % to about 1%.
    m = opticsGet(optics,'magnification',sceneGet(scene,'distance'));
    ptbMagCorrectIrradiance = ptbIrradiance(:)/(1+abs(m))^2;
    
     
    %% Numerical check to decide whether we passed.
    % We are checking against a 1% error.
    tolerance = 0.01;
    
    ptbMagCorrectIrradiance = ptbMagCorrectIrradiance(:);
    isetbioIrradianceEnergy = isetbioIrradianceEnergy(:);
    difference = ptbMagCorrectIrradiance-isetbioIrradianceEnergy;
   
    %% Set validationReport, validationFailedFlag and validationData
    if (max(abs(difference./isetbioIrradianceEnergy)) > tolerance)
        validationReport     = sprintf('Validation FAILED. Difference between PTB and isetbio irradiance exceeds tolerance of %0.5f %% !!!', 100*tolerance);
        validationFailedFlag = true;
    else
        validationReport     = sprintf('Validation PASSED. PTB and isetbio agree about irradiance to %0.5f %%',100*tolerance);
        validationFailedFlag = false;
    end

    validationDataToSave.fov        = fov;
    validationDataToSave.roiSize    = roiSize;
    validationDataToSave.tolerance  = tolerance;
    validationDataToSave.scene      = scene;
    validationDataToSave.oi         = oi;
    validationDataToSave.ptbMagCorrectIrradiance = ptbMagCorrectIrradiance;
    validationDataToSave.isetbioIrradianceEnergy = isetbioIrradianceEnergy;
    
    %% Generate plots, if so specified
    if (nargin >= 1) && (isfield(runParams, 'generatePlots')) && (runParams.generatePlots == true)
        h = figure(500);
        clf;
        set(h, 'Position', [100 100 800 600]);
        subplot(2,1,1);
        plot(wave, ptbIrradiance, 'ro', 'MarkerFaceColor', [1.0 0.8 0.8], 'MarkerSize', 10);
        hold on;
        plot(wave, isetbioIrradianceEnergy, 'bo', 'MarkerFaceColor', [0.8 0.8 1.0], 'MarkerSize', 10);
        hold off
        set(gca,'ylim',[0 1.2*max([max(ptbIrradiance(:)) max(isetbioIrradianceEnergy(:))])]);
        set(gca, 'FontName', 'Helvetica', 'FontSize', 14,  'FontWeight', 'bold');
        legend({'PTB','ISETBIO'}, 'Location','SouthEast','FontSize',12);
        xlabel('Wave (nm)', 'FontName', 'Helvetica', 'FontSize', 16); ylabel('Irradiance (q/s/nm/m^2)', 'FontName', 'Helvetica', 'FontSize', 16)
        title('Without magnification correction', 'FontName', 'Helvetica', 'FontSize', 18, 'FontWeight', 'bold');
    
        subplot(2,1,2);
        plot(wave,ptbMagCorrectIrradiance,'ro', 'MarkerFaceColor', [1.0 0.8 0.8], 'MarkerSize', 10);
        hold on;
        plot(wave,isetbioIrradianceEnergy,'bo', 'MarkerFaceColor', [0.8 0.8 1.0], 'MarkerSize', 10);
        hold off
        set(gca,'ylim',[0 1.2*max([max(ptbIrradiance(:)) max(isetbioIrradianceEnergy(:))])]);
        set(gca, 'FontName', 'Helvetica', 'FontSize', 14, 'FontWeight', 'bold');
        xlabel('Wave (nm)', 'FontName', 'Helvetica', 'FontSize', 14); ylabel('Irradiance (q/s/nm/m^2)', 'FontName', 'Helvetica', 'FontSize', 14)
        legend({'PTB','ISETBIO'}, 'Location','SouthEast','FontSize',12)
        title('Magnification-corrected comparison', 'FontName', 'Helvetica', 'FontSize', 18, 'FontWeight', 'bold');
    end 
    
end




##### SOURCE END #####
--></body></html>