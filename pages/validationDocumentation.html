<!DOCTYPE html>
<html>

<head>
<meta charset='utf-8'>
<meta http-equiv="X-UA-Compatible" content="chrome=1">
<meta name="description" content="isetbioValidation: script validation">

<link rel="stylesheet" type="text/css" media="screen" href="../stylesheets/stylesheet.css">

<!-- CUSTOM style classes -->
<style type="text/css">
<!--
.tab { margin-left: 20px; }
-->
</style>

<title>isetbioValidation</title>
</head>

<body>

<!-- HEADER -->
<div id="header_wrap" class="outer">
    <header class="inner">
      <h1 id="project_title">isetbio: script validation</h1>
      <h2 id="project_tagline">documentation and usage of the @UnitTest class</h2>
    </header>
</div>

<!-- MAIN CONTENT -->
<div id="main_content_wrap" class="outer">
  <section id="main_content" class="inner">
  
 <!-- --------  -->  
 <!-- OVERVIEW  --> 
 <!-- --------  --> 
 
<h2>
<a id="overview" class="anchor" href="#overview" aria-hidden="true"><span class="octicon octicon-link"></span></a>overview
</h2>


<p>This document describes how to use the custom @UnitTest class for validating isetbio scripts. The class executes isetbio scripts and manages the data generated by these scripts so as to conduct different levels of validation. Starting at the most basic (and fastest) level, the available <font color="#ff4477"> validation modes</font> are:
<ul>
  <li><font face="Menlo", color="#ff4477">'RUNTIME_ERRORS_ONLY'</font>:  only checking for run-time exceptions.</li>
  <li><font face="Menlo", color="#ff4477">'FAST'</font>: run-time exceptions + SHA-256 signature validation of select data.</li>
  <li><font face="Menlo", color="#ff4477">'FULL'</font>: run-time exceptions + numerical validation of select data.</li>
  <li><font face="Menlo", color="#ff4477">'PUBLISH'</font>: run-time exceptions + numerical validation + publication to <a href="https://github.com/isetbio/isetbio/wiki/ValidationResults" class="user-mention">github site</a>.
</ul>
</p> 

<p>
The <font face="Menlo", color="#ff4477">'RUNTIME_ERRORS_ONLY'</font> validation mode is the quickest and may be useful to ensure the basic integrity of isetbio core methods, for example that calls to isetbio functions do not crash. 

<p>The <font face="Menlo", color="#ff4477">'FAST'</font> validation mode can be used to check that data generated by isetbio scripts agree across different versions of isetbio and/or across different machines/operating systems.

<p>If any data inconsistencies are detected, the <font face="Menlo", color="#ff4477">'FULL'</font> validation run would be useful to identify the data fields whose values have changed and to provide quantitative descriptions of any differences. 

<p>Finally, the <font face="Menlo", color="#ff4477">'PUBLISH'</font> validation mode is useful as it generates published reports of isetbio code with plots of thegenerated data, in addition to full data validation. These reports which are published <a href="https://github.com/isetbio/isetbio/wiki/ValidationResults" class="user-mention">on isetbio's github site</a>, can serve as tutorials for the various functionalities of isetbio.


 <!-- --------------------  -->  
 <!-- VALIDATION OPERATIONS --> 
 <!-- --------------------  --> 
 
 
<h2>
<a id="validation operations" class="anchor" href="#designer-templates" aria-hidden="true"><span class="octicon octicon-link"></span></a>data validation operations
</h2>

<h5>
    <a id="data validation class="anchor" href="#overview" aria-hidden="true"><span class="octicon octicon-link"></span></a> &#x25cf external validation
</h5>
The @UnitTest class provides methods that enable a validation script to select specific data for inclusion to a validation dataset that corresponds to that script. The first time that a validation script is run, the generated validation dataset becomes the 'ground truth' for this script. In subsequent runs, methods of the @UnitTest class compare the generated dataset to the corresponding 'ground truth' dataset to establish whether the current run produces data that are consistent with the 'ground truth'. User-settable preferences in @UnitTest allow a validation dataset to be added to the history of validation datasets and/or ground truth data sets.
 
<p class="tab"><strong> 'FAST' validation mode: </strong>
In 'FAST' validations, all numerical fields of the validation dataset are truncated to 12 decimal digits, and a SHA-256 hash key is generated based on the truncated data set. A validation script passes 'FAST' validation, if the hash key matches exactly the hash key stored in the ground truth dataset. We have found that data truncation to 12 decimal digits generate hash keys that match across different computers (three Mac dekstops and one laptop, all running OSX), whereas truncation to 13 or more decimal digits generate hash keys that do not match across these computers. We do not know the situation about Windows/Linux computers yet.

<p>
<p class="tab"><strong> 'FULL' validation mode: </strong>In 'FULL' validations, all corresponding fields of the validation and ground truth data sets are compared numerically. A validation script passes 'FULL' data validation if the absolute differences between the corresponding fields in the two datasets do not exceed a numerical threshold, which is determinted by a user-setable @UnitTest preference.

<h5>
    <a id="internal validation class="anchor" href="#overview" aria-hidden="true"><span class="octicon octicon-link"></span></a> &#x25cf internal  validation
</h5>
The @UnitTest class also provides methods that allow additional validations which are based on internal (to the script) consistency checks specified within the validation script itself. For example, a validation script may check the agreement between the result generated by an isetbio computation and the result generated by other means, for example psychtoolbox computations. If the agreement is not satisfactory, the validation script can use @UnitTest class methods to declare that it has failed to pass validation.
<br>
<br>

 <!-- ------------------------  -->  
 <!-- @UNIT_TEST USAGE PATTERNS --> 
 <!-- ------------------------  --> 
 
<h2>
<a id="Usage patterns" class="anchor" href="#designer-templates" aria-hidden="true"><span class="octicon octicon-link"></span></a>@UnitTest usage patterns
</h2>

<h4>
    <a id="basic usage="anchor" href="#overview" aria-hidden="true"><span class="octicon octicon-link"></span></a> &#x25cf basic usage
</h4>

A validation session can be conducted by calling the following executive method:

<pre>
<font face="Menlo">
UnitTest.runValidationSession(vScriptsList, <font color="#ff4477">validationMode</font>);
</font>
</pre>

where <font face="Menlo">vScriptsList</font> is a cell array containing the names of individual validation scripts or the names of validation script directories. 
<br>
<br>

<h6>
<a id="Example1" class="anchor" href="#designer-templates" aria-hidden="true"><span class="octicon octicon-link"></span></a><font color="#7777cc", face="Menlo, size="">Example 1: validating individual scripts. </font>
</h6>
<pre><code>
vScriptsList = {...
   {'v_Colorimetry'} ...
   {'v_IrradianceIsomerizations'} ...
};

UnitTest.runValidationSession(vScriptsList, <font color="#ff4477">'FAST'</font>);
</code></pre>
The above code segment can be used to conduct a 'FAST' validation of scripts <font face="Menlo">'v_Colorimetry.m', 'v_IrradianceIsomerizations.m'</font>.

<br>
<br>
<h6>
<a id="Example2" class="anchor" href="#designer-templates" aria-hidden="true"><span class="octicon octicon-link"></span></a><font color="#7777cc", face="Menlo, size="">Example 2: validating scripts in directories. </font>
</h6>
<pre><code>
vScriptsList = {...
  {'validationScripts/color'} ...
  {'validationScripts/cones'} ...
  {'validationScripts/human'} ...
  {'validationScripts/radiometry'} ...
};

UnitTest.runValidationSession(vScriptsList, <font color="#ff4477">'FULL'</font>);
</code></pre>
The above code segment can be used to conduct a 'FULL' validation of all scripts contained in directories:
<ul>
  <li><font face="Menlo">'$ISETBIOROOT/validation/validationScripts/color</font></li>
  <li><font face="Menlo">'$ISETBIOROOT/validation/validationScripts/cones</font></li>
  <li><font face="Menlo">'$ISETBIOROOT/validation/validationScripts/human</font></li>
  <li><font face="Menlo">'$ISETBIOROOT/validation/validationScripts/radiometry</font></li>
</ul>


<h4>
    <a id="tuning the validation run="anchor" href="#overview" aria-hidden="true"><span class="octicon octicon-link"></span></a> &#x25cf tuning the validation run
</h4>

The user can fine tune how validation runs are performed by setting various @UnitTest preferences. Currently, the following preferences are available:

  </body>
</html>
